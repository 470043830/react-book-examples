import React from 'react';
import localforage from 'localforage';
import pako from 'pako';
import logo from './logo.svg';
import './App.scss';


class App extends React.Component {
    constructor(props) {
        super(props);
        this.state = {};
    }

    _deflateStr = (inputStr) => {
        return pako.deflate(inputStr, { to: 'string' });
    };

    _inflateStr = (binaryString) => {
        return pako.inflate(binaryString, { to: 'string' });
    };

    localforageExample() {
        localforage.setItem('somekey', 'some value').then(function (value) {
            // 当值被存储后，可执行其他操作
            console.log('localforage setItem: ', value);
        }).catch(function (err) {
            // 当出错时，此处代码运行
            console.log('localforage setItem: ', err);
        });

        // 不同于 localStorage，你可以存储非字符串类型
        localforage.setItem('my array', [1, 2, 'three', { v1: '777' }]).then(function (value) {
            // 如下输出 `1`
            console.log(value[0]);
        }).catch(function (err) {
            // 当出错时，此处代码运行
            console.log(err);
        });

        localforage.getItem('somekey').then(function (value) {
            // 当离线仓库中的值被载入时，此处代码运行
            console.log('localforage getItem: ', value);
        }).catch(function (err) {
            // 当出错时，此处代码运行
            console.log('localforage getItem: ', err);
        });

        // 回调版本：
        localforage.getItem('my array', function (err, value) {
            // 当离线仓库中的值被载入时，此处代码运行
            console.log('localforage getItem: ', value, value instanceof Array);
        });
    }

    onbtn1 = () => {
        console.log('onbtn1...');
        this.localforageExample();
    }

    onbtn2 = () => {
        console.log('onbtn2...');
        let bstr = this._deflateStr('localforageExamplelocalforageExamplelocalforageExample');
        let ostr = this._inflateStr(bstr);
        console.log('ostr: ', ostr, bstr);
    }

    render(){
        return (
            <div className="App">
                <header className="App-header">
                    <img src={logo} className="App-logo" alt="logo" />
                    <p>Edit <code>src/App.js</code> and save to reload.</p>
                    <a
                        className="App-link"
                        href="https://reactjs.org"
                        target="_blank"
                        rel="noopener noreferrer"
                    >Learn React</a>
                    <button className="my-button my-button_btn1" onClick={this.onbtn1}>button1</button>
                    <button className="my-button my-button_btn2" onClick={this.onbtn2}>button2</button>
                </header>
            </div>
        );
    }
}

export default App;
